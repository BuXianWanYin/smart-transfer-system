# å‰åç«¯å“åº”æ ¼å¼ç»Ÿä¸€è¯´æ˜

## ğŸ“‹ åç«¯ç»Ÿä¸€å“åº”æ ¼å¼

### **Result åŒ…è£…ç±»**

**ä½ç½®ï¼š** `common/Result.java`

**ç»“æ„ï¼š**
```java
public class Result<T> {
    private Integer code;      // å“åº”ç ï¼š200-æˆåŠŸï¼Œå…¶ä»–-å¤±è´¥
    private String message;    // å“åº”æ¶ˆæ¯
    private T data;           // ä¸šåŠ¡æ•°æ®
    private Long timestamp;    // æ—¶é—´æˆ³
}
```

---

## ğŸ¯ æ‰€æœ‰æ¥å£å“åº”æ ¼å¼

### **âœ… å·²æ£€æŸ¥ï¼šæ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨ Result åŒ…è£…**

#### **1. æ™®é€šå¯¹è±¡æ¥å£**

**ç¤ºä¾‹ï¼šæ–‡ä»¶ä¸Šä¼ åˆå§‹åŒ–**
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "fileId": 1,
    "quickUpload": false,
    "uploadedChunks": [],
    "message": "æ–‡ä»¶ä¸Šä¼ åˆå§‹åŒ–æˆåŠŸ"
  },
  "timestamp": 1736157632000
}
```

#### **2. åˆ†é¡µå¯¹è±¡æ¥å£**

**ç¤ºä¾‹ï¼šæ–‡ä»¶åˆ—è¡¨æŸ¥è¯¢**
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "records": [
      {
        "id": 1,
        "fileName": "test.txt",
        "fileSize": 1024,
        "uploadStatus": "COMPLETED"
      }
    ],
    "total": 10,
    "size": 10,
    "current": 1,
    "pages": 1
  },
  "timestamp": 1736157632000
}
```

#### **3. åˆ—è¡¨æ¥å£**

**ç¤ºä¾‹ï¼šè·å–æ‰€æœ‰é…ç½®**
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": [
    {
      "id": 1,
      "configKey": "congestion.algorithm",
      "configValue": "ADAPTIVE"
    }
  ],
  "timestamp": 1736157632000
}
```

#### **4. ç®€å•å€¼æ¥å£**

**ç¤ºä¾‹ï¼šè·å–å½“å‰ç®—æ³•**
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "Adaptive(BBR)",
  "timestamp": 1736157632000
}
```

#### **5. æ— è¿”å›æ•°æ®æ¥å£**

**ç¤ºä¾‹ï¼šåˆ é™¤æ–‡ä»¶**
```json
{
  "code": 200,
  "message": "æ–‡ä»¶åˆ é™¤æˆåŠŸ",
  "data": null,
  "timestamp": 1736157632000
}
```

---

## ğŸŒ å‰ç«¯å“åº”æ‹¦æˆªå™¨

### **ä½ç½®ï¼š** `smart-transfer-web/src/utils/http/index.js`

### **å½“å‰å®ç°ï¼š**

```javascript
service.interceptors.response.use(
  response => {
    const res = response.data  // Axios å“åº”çš„ data å­—æ®µ
    
    // ä¸šåŠ¡é”™è¯¯å¤„ç†
    if (res.code !== 200) {
      ElMessage.error(res.message || 'è¯·æ±‚å¤±è´¥')
      return Promise.reject(new Error(res.message || 'è¯·æ±‚å¤±è´¥'))
    }
    
    // âœ… è¿”å›ä¸šåŠ¡æ•°æ®ï¼ˆdata å­—æ®µï¼‰
    return res.data
  },
  error => {
    ElMessage.error(error.message || 'ç½‘ç»œé”™è¯¯')
    return Promise.reject(error)
  }
)
```

### **æ•°æ®æµè½¬ï¼š**

```
åç«¯è¿”å›
â†“
{ code: 200, message: '...', data: {...} }
â†“
Axios å¤„ç†
â†“
response.data = { code: 200, message: '...', data: {...} }
â†“
å“åº”æ‹¦æˆªå™¨
â†“
const res = response.data
return res.data  // è¿”å›å®é™…ä¸šåŠ¡æ•°æ®
â†“
å‰ç«¯æ¥æ”¶
â†“
{ fileId: 1, quickUpload: false, ... }
æˆ–
{ records: [...], total: 10, ... }
```

---

## ğŸ“Š å‰ç«¯è°ƒç”¨æ–¹å¼

### **1. æ™®é€šå¯¹è±¡æ¥å£**

```javascript
// API è°ƒç”¨
const result = await initUpload({...})

// âœ… ç›´æ¥è®¿é—®ä¸šåŠ¡æ•°æ®
console.log(result.fileId)       // 1
console.log(result.quickUpload)  // false
```

### **2. åˆ†é¡µæ¥å£**

```javascript
// API è°ƒç”¨
const result = await getFileList({...})

// âœ… ç›´æ¥è®¿é—®åˆ†é¡µæ•°æ®
console.log(result.records)  // [...]
console.log(result.total)    // 10
console.log(result.current)  // 1
```

### **3. åˆ—è¡¨æ¥å£**

```javascript
// API è°ƒç”¨
const result = await getAllConfigs()

// âœ… ç›´æ¥è®¿é—®åˆ—è¡¨æ•°æ®
console.log(Array.isArray(result))  // true
console.log(result.length)          // N
```

### **4. ç®€å•å€¼æ¥å£**

```javascript
// API è°ƒç”¨
const result = await getCurrentAlgorithm()

// âœ… ç›´æ¥è®¿é—®å­—ç¬¦ä¸²å€¼
console.log(typeof result)  // 'string'
console.log(result)         // 'Adaptive(BBR)'
```

---

## âœ… æ‰€æœ‰ Controller æ¥å£æ£€æŸ¥

### **FileControllerï¼ˆ9ä¸ªæ¥å£ï¼‰**

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¿”å›ç±»å‹ | çŠ¶æ€ |
|------|------|------|----------|------|
| åˆå§‹åŒ–ä¸Šä¼  | POST | `/api/file/upload/init` | `Result<FileUploadInitVO>` | âœ… |
| ä¸Šä¼ åˆ†ç‰‡ | POST | `/api/file/upload/chunk` | `Result<ChunkUploadVO>` | âœ… |
| åˆå¹¶æ–‡ä»¶ | POST | `/api/file/merge` | `Result<FileMergeVO>` | âœ… |
| æŸ¥è¯¢ä»»åŠ¡ | GET | `/api/file/task/{taskId}` | `Result<TransferTaskVO>` | âœ… |
| ä»»åŠ¡åˆ—è¡¨ | POST | `/api/file/task/list` | `Result<IPage<TransferTaskVO>>` | âœ… |
| åˆ é™¤ä»»åŠ¡ | DELETE | `/api/file/task/{taskId}` | `Result<Void>` | âœ… |
| æ–‡ä»¶åˆ—è¡¨ | GET | `/api/file/list` | `Result<IPage<FileInfoVO>>` | âœ… |
| æ–‡ä»¶è¯¦æƒ… | GET | `/api/file/{id}` | `Result<FileInfoVO>` | âœ… |
| åˆ é™¤æ–‡ä»¶ | DELETE | `/api/file/{id}` | `Result<String>` | âœ… |
| ä¸‹è½½æ–‡ä»¶ | GET | `/api/file/download/{id}` | `ResponseEntity<Resource>` | âš ï¸ æ–‡ä»¶æµ |

### **CongestionControllerï¼ˆ4ä¸ªæ¥å£ï¼‰**

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¿”å›ç±»å‹ | çŠ¶æ€ |
|------|------|------|----------|------|
| è·å–æŒ‡æ ‡ | GET | `/api/congestion/metrics` | `Result<CongestionMetricsVO>` | âœ… |
| è·å–ç®—æ³• | GET | `/api/congestion/algorithm` | `Result<String>` | âœ… |
| åˆ‡æ¢ç®—æ³• | POST | `/api/congestion/algorithm` | `Result<String>` | âœ… |
| ç®—æ³•çŠ¶æ€ | GET | `/api/congestion/status` | `Result<String>` | âœ… |

### **ConfigControllerï¼ˆ5ä¸ªæ¥å£ï¼‰**

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¿”å›ç±»å‹ | çŠ¶æ€ |
|------|------|------|----------|------|
| è·å–æ‹¥å¡é…ç½® | GET | `/api/config/congestion` | `Result<Map<String, String>>` | âœ… |
| æ›´æ–°æ‹¥å¡é…ç½® | POST | `/api/config/congestion` | `Result<String>` | âœ… |
| åˆ·æ–°é…ç½® | POST | `/api/config/refresh` | `Result<String>` | âœ… |
| è·å–æ‰€æœ‰é…ç½® | GET | `/api/config/list` | `Result<List<SystemConfig>>` | âœ… |
| è·å–é…ç½®å€¼ | GET | `/api/config/value` | `Result<String>` | âœ… |

---

## ğŸ¯ ç»Ÿä¸€æ€§éªŒè¯

### **âœ… åç«¯ç»Ÿä¸€æ€§**

- âœ… **æ‰€æœ‰ä¸šåŠ¡æ¥å£éƒ½ä½¿ç”¨ `Result<T>` åŒ…è£…**
- âœ… **æ–‡ä»¶ä¸‹è½½æ¥å£ä½¿ç”¨ `ResponseEntity<Resource>`ï¼ˆç‰¹æ®Šæƒ…å†µï¼‰**
- âœ… **é”™è¯¯å“åº”ç»Ÿä¸€æ ¼å¼**

### **âœ… å‰ç«¯ç»Ÿä¸€æ€§**

- âœ… **å“åº”æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç† `Result` åŒ…è£…**
- âœ… **ä¸šåŠ¡é”™è¯¯ç»Ÿä¸€æ‹¦æˆªå’Œæç¤º**
- âœ… **ç½‘ç»œé”™è¯¯ç»Ÿä¸€å¤„ç†**

---

## ğŸ“ å‰ç«¯è°ƒç”¨ç¤ºä¾‹

### **ç¤ºä¾‹1ï¼šæ–‡ä»¶åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰**

```javascript
// FileList.vue
const fetchFileList = async () => {
  try {
    loading.value = true
    const res = await getFileList(queryForm.value)
    
    // âœ… res ç›´æ¥æ˜¯ IPage å¯¹è±¡
    fileList.value = res.records || []  // æ–‡ä»¶åˆ—è¡¨
    total.value = res.total || 0        // æ€»æ•°
  } catch (error) {
    ElMessage.error('è·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥')
  } finally {
    loading.value = false
  }
}
```

### **ç¤ºä¾‹2ï¼šæ–‡ä»¶ä¸Šä¼ åˆå§‹åŒ–ï¼ˆå¯¹è±¡ï¼‰**

```javascript
// FileUploader.vue
const startUpload = async (item) => {
  try {
    const initRes = await initUpload({
      fileName: item.fileName,
      fileSize: item.fileSize,
      fileHash: fileHash,
      chunkSize: chunkSize,
      totalChunks: chunks.length
    })
    
    // âœ… initRes ç›´æ¥æ˜¯ FileUploadInitVO å¯¹è±¡
    if (initRes.quickUpload) {
      ElMessage.success('æ–‡ä»¶å·²å­˜åœ¨ï¼Œç§’ä¼ æˆåŠŸï¼')
      return
    }
    
    item.fileId = initRes.fileId
    item.uploadedChunks = initRes.uploadedChunks || []
    
    // ç»§ç»­ä¸Šä¼ ...
  } catch (error) {
    ElMessage.error('ä¸Šä¼ å¤±è´¥')
  }
}
```

### **ç¤ºä¾‹3ï¼šæ‹¥å¡ç›‘æ§ï¼ˆå¯¹è±¡ï¼‰**

```javascript
// CongestionMonitor.vue
const fetchMetrics = async () => {
  try {
    const res = await getCongestionMetrics()
    
    // âœ… res ç›´æ¥æ˜¯ CongestionMetricsVO å¯¹è±¡
    currentMetrics.value = res
    
    console.log(res.algorithm)      // "Adaptive(BBR)"
    console.log(res.cwnd)          // 10485760
    console.log(res.networkQuality) // "ä¼˜ç§€"
  } catch (error) {
    console.error('è·å–æŒ‡æ ‡å¤±è´¥', error)
  }
}
```

### **ç¤ºä¾‹4ï¼šæ‹¥å¡é…ç½®ï¼ˆMapï¼‰**

```javascript
// CongestionConfig.vue
const loadConfig = async () => {
  try {
    const res = await getCongestionConfig()
    
    // âœ… res ç›´æ¥æ˜¯ Map å¯¹è±¡
    config.value = {
      algorithm: res['algorithm'],
      initialCwnd: res['initial_cwnd'],
      ssthresh: res['ssthresh'],
      maxCwnd: res['max_cwnd'],
      // ...
    }
  } catch (error) {
    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥')
  }
}
```

---

## âš ï¸ ç‰¹æ®Šæƒ…å†µ

### **æ–‡ä»¶ä¸‹è½½æ¥å£**

æ–‡ä»¶ä¸‹è½½æ¥å£ä¸ä½¿ç”¨ `Result` åŒ…è£…ï¼Œç›´æ¥è¿”å›æ–‡ä»¶æµï¼š

```java
@GetMapping("/download/{id}")
public ResponseEntity<Resource> downloadFile(@PathVariable Long id) {
    // è¿”å›æ–‡ä»¶æµ
    return ResponseEntity.ok()
            .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=" + fileName)
            .contentType(MediaType.APPLICATION_OCTET_STREAM)
            .body(resource);
}
```

**å‰ç«¯å¤„ç†ï¼š**
```javascript
// ç›´æ¥ä½¿ç”¨ä¸‹è½½é“¾æ¥
export function getDownloadUrl(id) {
  return `${import.meta.env.VITE_API_BASE_URL}/file/download/${id}`
}

// HTML
<a :href="getDownloadUrl(file.id)" download>ä¸‹è½½</a>
```

---

## ğŸŠ æ€»ç»“

### **æ ¼å¼ç»Ÿä¸€æ€§ï¼š**

```
âœ… åç«¯ï¼š100% æ¥å£ä½¿ç”¨ Result<T> åŒ…è£…ï¼ˆé™¤æ–‡ä»¶ä¸‹è½½ï¼‰
âœ… å‰ç«¯ï¼šå“åº”æ‹¦æˆªå™¨ç»Ÿä¸€è¿”å› res.dataï¼ˆä¸šåŠ¡æ•°æ®ï¼‰
âœ… é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€æ‹¦æˆªå’Œæç¤º
âœ… æ•°æ®è®¿é—®ï¼šå‰ç«¯ç›´æ¥è®¿é—®ä¸šåŠ¡æ•°æ®ï¼Œæ— éœ€å¤šå±‚åµŒå¥—
```

### **ä¼˜ç‚¹ï¼š**

1. **ä»£ç ç®€æ´** - å‰ç«¯æ— éœ€æ¯æ¬¡éƒ½è®¿é—® `.data.data`
2. **ç±»å‹å®‰å…¨** - TypeScript å¯ä»¥ç›´æ¥æ¨æ–­ä¸šåŠ¡æ•°æ®ç±»å‹
3. **æ˜“äºç»´æŠ¤** - å“åº”æ ¼å¼ç»Ÿä¸€ï¼Œä¿®æ”¹æ–¹ä¾¿
4. **é”™è¯¯ç»Ÿä¸€** - ä¸šåŠ¡é”™è¯¯å’Œç½‘ç»œé”™è¯¯éƒ½åœ¨æ‹¦æˆªå™¨å¤„ç†

---

**å‰åç«¯å“åº”æ ¼å¼å®Œå…¨ç»Ÿä¸€ï¼** ğŸ‰

**å½“å‰å“åº”æ‹¦æˆªå™¨è¿”å› `res.data` æ˜¯æ­£ç¡®çš„ï¼**

